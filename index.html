<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>AR Hand Tracking VR Passthrough</title>
  <style>
    body { margin:0; overflow:hidden; background:black; }
    canvas, video { position:absolute; top:0; left:0; width:100%; height:100%; }
  </style>
</head>
<body>
  <video id="video" autoplay playsinline muted style="display:none"></video>
  <canvas id="handsCanvas"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
  <script>
  // Setup video + hands
  const videoEl = document.getElementById('video');
  const handsCanvas = document.getElementById('handsCanvas');
  const ctx = handsCanvas.getContext('2d');
  handsCanvas.width = window.innerWidth;
  handsCanvas.height = window.innerHeight;

  const hands = new Hands({locateFile: f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
  hands.setOptions({maxNumHands:1,minDetectionConfidence:0.7,minTrackingConfidence:0.5});
  hands.onResults(results=>{
    ctx.clearRect(0,0,handsCanvas.width,handsCanvas.height);
    ctx.drawImage(results.image,0,0,handsCanvas.width,handsCanvas.height);
    if (results.multiHandLandmarks) {
      const lm = results.multiHandLandmarks[0][8]; // vingerpunt
      followFinger(lm.x * handsCanvas.width, lm.y * handsCanvas.height);
    }
  });

  const camera = new Camera(videoEl, {onFrame: async ()=>{await hands.send({image:videoEl});},width:640,height:480});
  camera.start();

  // Three.js scène voor 3D object
  const scene = new THREE.Scene();
  const camera3 = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 10);
  camera3.position.z = 1;
  const renderer = new THREE.WebGLRenderer({alpha:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);
  const geometry = new THREE.SphereGeometry(0.1,32,32);
  const material = new THREE.MeshNormalMaterial();
  const sphere = new THREE.Mesh(geometry, material);
  scene.add(sphere);

  function followFinger(x, y) {
    // Zet bereik van scherm naar -0.5…0.5 → wereldruimte
    const nx = (x/window.innerWidth - 0.5) * 1;
    const ny = -(y/window.innerHeight - 0.5) * 1;
    sphere.position.set(nx, ny, 0);
  }

  function animate(){
    requestAnimationFrame(animate);
    renderer.render(scene, camera3);
  }
  animate();
  </script>
</body>
</html>
